import {getDetailsForUUID} from "../../client/api-client";
import {useEffect, useState} from "react";
import {useRouter} from 'next/router'
import Head from "next/head";
import {Box, Heading} from "@chakra-ui/react";

export default function TranscriptionResult({ id }) {
    const [transcriptionResult, setTranscriptionResult] = useState<any>(null); // TODO: type this
    const router = useRouter()

    const { refId } = router.query
    const getResults = (refId) => {
        console.info("Trying to get results for " + refId);
        if (!refId) return;
        console.debug("have uuid");
        console.debug("sending request");
        getDetailsForUUID(refId).then((data) => {
            if (data["result"]) {
                console.debug("have data", data);
                setTranscriptionResult(JSON.parse(data["result"]));
            } else {
                setTranscriptionResult("Transcription still in progress...!")
            }
        });

    }
    useEffect(() => {
        getResults(refId);
    },[refId])

    return (
        <>
            <Head>
                <title>transcribe</title>
                {/*<meta name="description" content="Generated by create next app" />*/}
                <meta name="viewport" content="width=device-width, initial-scale=1" />
                <link rel="icon" href="/favicon.ico" />
                <link rel="stylesheet" href="https://unpkg.com/mvp.css@1.12/mvp.css" />
            </Head>
            <main>
                <section>
                    {/*<header><h2>{refId}</h2></header>*/}
                    {!transcriptionResult &&
                        <Box paddingTop={10} paddingBottom={10}>
                            <Heading as={"h5"}>Transcription is non-existent or still in progress!</Heading>
                        </Box>
                    }
                    {transcriptionResult &&
                        <aside>{transcriptionResult}</aside>
                    }
                </section>
            </main>
        </>
    )

}
